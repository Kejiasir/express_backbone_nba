fs = require 'fs'
path = require 'path'

fs.ensureDir = (dir, callback)->
    fs.exists dir,(exists)->
        if !exists
            fs.mkdir dir
            console.log '新建目录:',dir
        callback null
fs.copyFile = (source,target,callback)->
    async.waterfall [
        (cb)->
            fs.readFile source,(err,buffer)->
                cb err,buffer
        (buffer,cb)->
            fs.ensureDir (path.dirname target),(err)->
                cb err,buffer
        (buffer,cb)->
            fs.writeFile target,buffer,(err)->
                cb err
    ],(err)->
        callback err
fs.mvFile = (source,target,callback)->
    async.waterfall [
        (cb)->
            fs.copyFile source,target,(err)->
                cb err
        (cb)->
            fs.unlink source,(err)->
                cb err
    ],(err)->
        callback err
module.exports = fs